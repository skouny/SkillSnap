@page "/demo"
@inject PortfolioUserService UserService
@inject UserSessionService UserSession
@using System.Diagnostics
@* Demo page to showcase all components *@

<PageTitle>SkillSnap - Demo</PageTitle>

<div class="demo-container">
    <h1>SkillSnap Portfolio Demo</h1>

    @* Performance Metrics *@
    @if (loadTime.HasValue)
    {
        <div class="performance-metrics">
            <span class="metric">âš¡ Page loaded in <strong>@loadTime.Value ms</strong></span>
            @if (UserSession.IsAuthenticated)
            {
                <span class="metric">ðŸ‘¤ Logged in as <strong>@UserSession.UserName</strong></span>
            }
        </div>
    }

    @if (isLoading)
    {
        <div class="loading-section">
            <p>Loading portfolio data...</p>
        </div>
    }
    else if (user != null)
    {
        <section class="demo-section">
            <ProfileCard Name="@user.Name" Bio="@user.Bio" ProfileImageUrl="@user.ProfileImageUrl" />
        </section>

        <section class="demo-section">
            <ProjectList />
        </section>

        <section class="demo-section">
            <SkillTags />
        </section>
    }
    else
    {
        <div class="error-section">
            <p><strong>No portfolio data available.</strong></p>
            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <p class="error-details" style="color: red; font-weight: bold;">Error Details: @errorMessage</p>
            }
            <div class="troubleshooting">
                <h4>Troubleshooting Steps:</h4>
                <ol>
                    <li>Make sure the API is running on http://localhost:5064</li>
                    <li>Seed the database by running: <code>POST http://localhost:5064/api/seed</code></li>
                    <li>Check the browser console (F12) for detailed error messages</li>
                    <li>Verify CORS is configured correctly in the API</li>
                </ol>
            </div>
        </div>
    }
</div>

@code {
    private PortfolioUser? user;
    private bool isLoading = true;
    private string? errorMessage;
    private long? loadTime;
    private Stopwatch stopwatch = new Stopwatch();

    protected override async Task OnInitializedAsync()
    {
        stopwatch.Start();

        try
        {
            user = await UserService.GetFirstUserAsync();
            if (user == null)
            {
                errorMessage = "No user data returned from API";
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading user data: {ex.Message}");
            errorMessage = ex.Message;
        }
        finally
        {
            stopwatch.Stop();
            loadTime = stopwatch.ElapsedMilliseconds;
            isLoading = false;
            Console.WriteLine($"Demo page loaded in {loadTime}ms");
        }
    }
}

<style>
    .demo-container {
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
    }

    .demo-container h1 {
        text-align: center;
        color: #333;
        margin-bottom: 2rem;
        font-size: 2.5rem;
    }

    .demo-section {
        margin-bottom: 3rem;
    }

    .loading-section,
    .error-section {
        text-align: center;
        padding: 3rem;
        color: #666;
    }

    .error-section .hint {
        font-family: monospace;
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 4px;
        margin-top: 1rem;
        color: #333;
    }

    .troubleshooting {
        text-align: left;
        max-width: 600px;
        margin: 2rem auto;
        padding: 1rem;
        background-color: #fff3cd;
        border-radius: 8px;
        border-left: 4px solid #ffc107;
    }

    .troubleshooting h4 {
        margin-top: 0;
        color: #856404;
    }

    .troubleshooting code {
        background-color: #fff;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-size: 0.9em;
    }

    .error-details {
        background-color: #f8d7da;
        padding: 1rem;
        border-radius: 4px;
        border-left: 4px solid #dc3545;
        margin: 1rem 0;
    }

    .performance-metrics {
        display: flex;
        justify-content: center;
        gap: 2rem;
        padding: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 8px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .performance-metrics .metric {
        font-size: 0.95rem;
    }

    .performance-metrics strong {
        font-weight: 700;
    }
</style>